Authentication System â€“ Requirements and High-Level Design
1. Objective

Design and implement a secure authentication system for a web application using:

Frontend: Next.js

Backend: FastAPI

Database: PostgreSQL

Authentication Mechanism: JWT-based authentication using HttpOnly cookies

The system must support secure user registration, admin-controlled verification, login, token refresh, logout, and access to protected APIs.

2. Functional Requirements
2.1 User Registration (Signup)

The system must allow users to register with:

Email

Password

Full name

The system must:

Ensure email uniqueness.

Hash passwords before storing them in the database.

Create users with:

is_active = true

is_verified = false (default)

After signup:

The user cannot log in until verified by an admin.

The API should return a success message indicating that verification is pending.

2.2 Admin Verification

Only an administrator can set:

is_verified = true

Users must not be able to log in if:

is_verified = false

is_active = false

Verification will be handled manually from the backend (admin-controlled).

2.3 Login

Users authenticate using:

Email

Password

The system must:

Validate credentials.

Reject login if:

User does not exist.

Password is incorrect.

is_active = false

is_verified = false

On successful authentication:

Generate:

Short-lived Access Token

Long-lived Refresh Token

Store both tokens in HttpOnly cookies.

2.4 Access to Protected Endpoints

Protected APIs must:

Require a valid access token.

Extract user identity from the JWT.

Deny access if token is invalid or expired.

Tokens must be automatically included by the browser via cookies.

2.5 Token Refresh

If the access token expires:

The client calls a refresh endpoint.

The refresh token is validated.

A new access token is issued.

The access token cookie is replaced.

2.6 Logout

Logout endpoint must:

Clear access token cookie.

Clear refresh token cookie.

After logout:

The user must not be able to access protected routes.
